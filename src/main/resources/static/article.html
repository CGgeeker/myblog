<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>极客星辰个人博客</title>
</head>

<!--<link href="//cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">-->
<link href="/plugin/bootstrap/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="/css/common.css"/>
<link rel="stylesheet" type="text/css" href="/css/article.css"/>
<link rel="stylesheet" href="/plugin/jquery.page.css">
<link href="/logo.ico" rel="shortcut icon"/>
<!--<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>
<script src="//cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>-->
<script src="/plugin/jquery.min.js"></script>
<script src="/plugin/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/plugin/jquery.page.js"></script>
<script src="/js/common.js"></script>
<script src="/layui/layui.all.js"></script>

<!--<script src="js/snowy.js"></script>-->
<script type="text/javascript">
	
/*$(function(){
	$("#page").Page({
	  totalPages: 7,//分页总数
	  liNums: 5,//分页的数字按钮数(建议取奇数)
	  activeClass: 'activP', //active 类样式定义
	  callBack : function(page){
			//console.log(page)
	  }
  });
})*/
</script>

<body>
	<div class="w_header">
		<div class="container">
			<div class="w_header_top">
				<a href="#" class="w_logo"></a>
				<span class="w_header_nav">
					<ul>
						<li><a href="/index.html">首页</a></li>
						<li><a href="/about.html" >关于</a></li>
						<li><a href="/article.html"  class="active">成长</a></li>
						<li><a href="">学习</a></li>
						<li><a href="">娱乐</a></li>
						<li><a href="/moodList.html">说说</a></li>
						<li><a href="/comment.html">留言</a></li>
					</ul>
				</span>
				<div class="w_search">
					<div class="w_searchbox">
						<input type="text" placeholder="search" />
						<button>搜索</button>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="w_container">
		<div class="container">
			<div class="row w_main_row">
				
				<ol class="breadcrumb w_breadcrumb">
				  <li><a href="#">首页</a></li>
				  <li class="active">文章</li>
				  <span class="w_navbar_tip">我们长路漫漫，只因学无止境。</span>
				</ol>
				
				<div class="col-lg-9 col-md-9 w_main_left">
					<div class="panel panel-default">
					  <div class="panel-body contentList">
					  	
					  	<!--<div class="panel panel-default w_article_item">
						  <div class="panel-body">
						    <div class="row">
							  <div class="col-xs-6 col-md-3">
							    <a href="#" class="thumbnail w_thumbnail">
							      <img src="/img/brain.jpg" alt="...">
							    </a>
							  </div>
							
							  <h4 class="media-heading">
							  	<a class="title" href="/article_detail.html">Media heading</a>
							  </h4>
							  <p><a class="label label-default">Nginx</a><a class="label label-default">tomcat负载均衡</a></p>
							  <p class="w_list_overview overView">个人博客网站正在建设中。。。。</p>
							  <p class="count_r"><span class="count"><i class="glyphicon glyphicon-user"></i><a href="#">admin</a></span> <span class="count"><i class="glyphicon glyphicon-eye-open"></i>阅读:1003</span><span class="count"><i class="glyphicon glyphicon-comment"></i>评论:2</span><span class="count"><i class="glyphicon glyphicon-time"></i>2017-01-16</span></p>
							</div>
						  </div>
						</div>-->

						
						
						<!--<div class="page">
							<nav aria-label="Page navigation">
						  <ul class="pagination">
						    <li>
						      <a href="#" aria-label="Previous">
						        <span aria-hidden="true">&laquo;</span>
						      </a>
						    </li>
						    <li class="active"><a href="#">1</a></li>
						    <li><a href="#">2</a></li>
						    <li><a href="#">3</a></li>
						    <li><a href="#">4</a></li>
						    <li><a href="#">5</a></li>
						    <li>
						      <a href="#" aria-label="Next">
						        <span aria-hidden="true">&raquo;</span>
						      </a>
						    </li>
						  </ul>
						</nav>
						</div>-->
						<!--<div id="page">
							
						</div>-->
						
						
					  </div>
					</div>
					
				</div>
				<div class="col-lg-3 col-md-3 w_main_right">
					
					<div class="panel panel-default">
					  <div class="panel-heading">
					    <h3 class="panel-title">最新发布</h3>
					  </div>
					  <div class="panel-body">
					    	<ul class="list-unstyled sidebar newpublish-ul">
								<!--<li><a href="/post/04928311">排序算法之冒泡排序 － java实现</a></li>-->
						</ul>
					  </div>
					</div>
					
					<div class="panel panel-default">
					  <div class="panel-heading">
					    <h3 class="panel-title">友情链接</h3>
					  </div>
					  <div class="panel-body">
					    <div class="newContent">
					    	<ul class="list-unstyled sidebar shiplink">				
								<li><a href="https://www.baidu.com/" target="_blank">百度</a></li>
								<li><a href="https://www.oschina.net/" target="_blank">开源中国</a></li>							
								<li><a href="http://www.ulewo.com/" target="_blank">有乐网</a></li>							
								<li><a href="http://www.sina.com.cn/" target="_blank">新浪网</a></li>							
								<li><a href="http://www.qq.com/" target="_blank">腾讯网</a></li>							
							</ul>
					    </div>
					  </div>
					</div>
				</div>
			
			
			</div>
		</div>
	</div>
	<div class="w_foot">
		<!--<div class="w_foot_copyright">© 2015~2016 版权所有 | <a target="_blank" href="http://www.miitbeian.gov.cn/" rel="nofollow">京ICP备15010892号-1</a></div>-->
		<div class="w_foot_copyright">Copyright © 2017-2020, www.cggeeker.cn. All Rights Reserved. </div>
	</div>
	<!--toTop-->
	<div id="shape">
		<div class="shapeColor">
			<div class="shapeFly">
			</div>
		</div>
	</div>
	<!--snow-->
	<!--<div class="snow-container"></div>-->

    <script type="text/javascript">

        $(function () {

            <!--获取指定范围内的文章信息的ajax-->
            $.ajax({
                type : "GET",
                url : "/article/findAllArticle",
                data : {
                    "startIndex" : 0,
                    "endIndex" : 6
                },
                dataType : "json",
                success : function (result1) {
                    console.log(result1);

                    if(result1.status == 200){
                        /*var listlength = result.data.length;*/
                        var articlearr = result1.data;

                        //jquery动态拼接li标签
                        for(let i in articlearr){

                            (function (i) {    //这里采用形如：(function(i){...})(i)的闭包方式解决var声明变量的作用域和js回收机制问题
                                <!--内套获取文章标签和评论数信息的ajax-->	//这里也可以直接用将var 变为let去声明变量就不需要闭包了！
                                $.ajax({
                                    type : "GET",
                                    url : "/articleandlabel/findArticleAndLabelAndArticleCountById",
                                    data : {
                                        "articleId" : parseInt(articlearr[i].articleId)
                                    },
                                    dataType : "json",
                                    success : function (result2) {
                                        if(result2.status == 200){
                                            var labelstr="";
                                            var publishTime = layui.util.toDateString(articlearr[i].publishTime, 'yyyy-MM-dd HH:mm:ss')//时间戳->常规时间格式
                                            var articleandlabelarr = result2.data.articleAndLabelList;  //获取该文章标签信息的list
                                            var articleCount = result2.data.articleCount;               //获取该文章的评论总数
                                            for(let j in articleandlabelarr){
                                                labelstr += '<a class="label label-default">'+articleandlabelarr[j].labelName+'</a>';
                                                console.log("{}{}{}{}}{}labelstr11 : " + labelstr);
                                            }

                                            //动态拼接首页左边最新发布的列表的子元素
                                            $('.contentList').append('<div class="panel panel-default w_article_item"><div class="panel-body"><div class="row"><div class="col-xs-6 col-md-3">'
                                                +'<a href="#" class="thumbnail w_thumbnail"><img src="'+ articlearr[i].articleImg +'" alt="..."></a></div>'
                                                +'<h4 class="media-heading"><a class="title article-a-getid" href="/article_detail.html?articleId='+articlearr[i].articleId+'" articleid="'+articlearr[i].articleId+'" readingnum="'+articlearr[i].readingNum+'">'+ articlearr[i].title +'</a></h4>'
                                                +'<p>'+ labelstr +'</p>'
                                                +'<p class="w_list_overview overView">'+ articlearr[i].content.substr(0,200) +'</p>'
                                                +'<p class="count_r"><span class="count"><i class="glyphicon glyphicon-user"></i><a href="#">'+ articlearr[i].author +'</a></span>'
                                                +'<span class="count"><i class="glyphicon glyphicon-eye-open"></i>阅读:'+ articlearr[i].readingNum +'</span>'
                                                +'<span class="count"><i class="glyphicon glyphicon-comment"></i>评论:'+ articleCount +'</span>'
                                                +'<span class="count"><i class="glyphicon glyphicon-time"></i>'+ publishTime +'</span>'
                                                +'</p></div></div></div>');


                                        }else{}
                                    },
                                    fail : function () {
                                        console.log("fail");
                                    },
                                    error : function () {
                                        console.log("error");
                                    }

                                });
                            })(i);

                        };

                    }else{}
                },
                fail : function () {
                    console.log("fail!")
                },
                error : function () {
                    console.log("error!")
                }
            });



            <!--获取指定范围内的文章信息(其实只获取文章标题)的ajax-->
            $.ajax({
                type: "GET",
                url: "/article/findAllArticle",
                data: {
                    "startIndex": 0,
                    "endIndex": 10
                },
                dataType: "json",
                success : function (result) {
                    if(result.status == 200){

                        var articlearr = result.data;

                        //jquery动态拼接li标签
                        for(let i in articlearr){

                            //动态拼接首页右边的简单的最新发布列表子元素
                            /*$('.newpublish-ul').append('<li><a href="/article_detail.html">'+articlearr[i].title+'</a></li>');*/
							$('.newpublish-ul').append('<li><a class="article-a-getid" href="/article_detail.html?articleId='+articlearr[i].articleId+'" articleid="'+articlearr[i].articleId+'" readingnum="'+articlearr[i].readingNum+'">'+articlearr[i].title+'</a></li>');
                        }

                    }else{}
                },
                fail : function () {
                    console.log("fail!")
                },
                error : function () {
                    console.log("error!")
                }
            });


            //为了避免ajax请求数据来生成文章div元素的慢于分页div元素，这里就设置一个定时器强制，分页div元素在页面加载完成后1s后再加载！
            var timer1 = window.setTimeout(function () {

                //动态生成分页div元素，并设置分页效果
                $('.contentList').append('<div id="page"></div>');
                $("#page").Page({
                    totalPages: 7,//分页总数
                    liNums: 5,//分页的数字按钮数(建议取奇数)
                    activeClass: 'activP', //active 类样式定义
                    callBack : function(page){
                        //console.log(page)
                    }
                });
            },1000)


			//为解决jquery动态生成节点造成节点点击事件失效，这里我们采用js的事件委托机制处理
			$(document).on("click",".article-a-getid",function(){
				var readingnum = $(this).attr("readingnum"); //JQuery通过click事件获取当前点击对象的非固定属性
				var articleid = $(this).attr("articleid");  //这里没有到，阅读量+1 的动作可以在前台处理，也可以在数据库处理
				/* alert("点击a标签阅读量："+readingnum+"文章id："+articleid);
                 console.log("点击a标签阅读量："+readingnum);*/

				//这是一个点击a标签后将阅读量+1 的ajax的post请求
				$.post("/article/updateTheArticleReadingNum", {
							"articleId" : articleid,
							"newAddNum" : 1},
						function (result) {
							console.log("阅读量+1成功！");
						});

			});


        });



    </script>


</body>
</html>