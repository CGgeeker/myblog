<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>极客星辰个人博客</title>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<script src="/layui/layui.all.js"></script>

<!--<link rel="stylesheet" type="text/css" href="http://apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.css">-->
<link href="/dist/summernote.css" rel="stylesheet"/>
<link href="/plugin/bootstrap/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="/plugin/bootstrap/css/bootstrap-select.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="/css/common.css"/>
<link rel="stylesheet" type="text/css" href="/css/about.css"/>
<link href="/logo.ico" rel="shortcut icon"/>

<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/bootstrap-select.min.js"></script>
<script src="/dist/summernote.js"></script>
<script src="/dist/lang/summernote-zh-CN.js"></script>    <!-- 中文-->

<style>
	*:focus { outline: none !important; }  /*去掉所有标签点击后默认边框样式（这里针对input）*/
	.m{ width: 94%; margin-left: auto; margin-right: auto; }
	.w_foot{margin-top: 15px;}
	.title-box{
		width: 100%;
		height: 36px;
		margin: 10px auto;
		line-height: 36px;
		background-color: #FFF;
	}
	.input-articletitle{
		width: 95%;
		height: 34px;
		font: 17px SimSun;
		border: none;
		outline: medium;
		padding-left: 10px;
	}
	.max-length{
		width: 5%;
		height: 34px;
		font: 18px SimSun;

	}
	.max-length-change{
		color: #32CD32;
	}
	.btn-addlabel{
		background-color: #FFF;
		color: #EE2C2C;
		border: 1px solid #EE2C2C ;
		border-radius: 12px;
	}
	.div-addnewarticle{
		margin: 15px auto;
		text-align: center;
	}
	.btn-addnewarticle{
		margin-right: 28px;
		background-color: #FFF;
		color: #EE2C2C;
		border: 1px solid #EE2C2C ;
		border-radius: 8px;
	}
	.btn-addlabel:hover , .btn-addnewarticle:hover{
		background-color: #EE2C2C;
		color: #FFF;
	}
	.btn-returnindex{
		margin-left: 28px;
		background-color: #FFF;
		color: #228B22;
		border: 1px solid #228B22 ;
		border-radius: 8px;
	}
	.btn-returnindex:hover{
		background-color: #228B22;
		color: #FFF;
	}
</style>

<script>
$(function(){
 $('.summernote').summernote({
        height: 400,
        tabsize: 1,
        lang: 'zh-CN'
    });
});
</script>

</head>

<body>

	<div class="w_header">
		<div class="container">
			<div class="w_header_top">
				<a href="#" class="w_logo"></a>
				<span class="w_header_nav">
						<ul>
							<li><a href="/index.html">首页</a></li>
							<li><a href="/about.html">关于</a></li>
							<li><a href="/article.html">成长</a></li>
							<li><a href="/editor.html" class="active">写博客</a></li>
							<li><a href="">娱乐</a></li>
							<li><a href="/moodList.html">说说</a></li>
							<li><a href="/comment.html">留言</a></li>
						</ul>
					</span>
				<div class="w_search">
					<div class="w_searchbox">
						<input type="text" placeholder="search" />
						<button>搜索</button>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="w_container">
		<div class="container">
			<div class="row w_main_row">

				<ol class="breadcrumb w_breadcrumb">
					<li><a href="/index.html">首页</a></li>
					<li class="active">关于我</li>
					<span class="w_navbar_tip">写博客也是一件很happy的事喃！</span>
				</ol>

				<div class="m">
					<div class="title-box">
						<input class="input-articletitle" type="text" id="txtTitle" maxlength="50" placeholder="输入文章标题">
						<span class="max-length"><span class="max-length-change">0</span>/50</span>
					</div>
					<div class="summernote">写点啥呢?</div>


					<div class="row">
						<label class="col-sm-1 control-label" style="line-height: 34px;margin-bottom: 20px;">文章标签:</label>
						<div class="div-articlelabel col-sm-3">
							<select id="select-articlelabel" name="select" class="selectpicker show-tick form-control" data-live-search="true">
								　<!--　<option value="Git">Git</option>-->
							</select>
						</div>


						<label class="col-sm-1 control-label" style="line-height: 34px;margin-bottom: 20px;">作 者 ：</label>
						<div class="div-articleauthor col-sm-2">
							<select id="select-articleauthor" name="select" class="selectpicker show-tick form-control" data-live-search="true">
								　<!--　<option value="CG">CG</option>
								　　<option value="CGgeeker">CGgeeker</option>-->
							</select>
						</div>

						<div class="col-sm-3">
							<input type="text" class="input-addlabel form-control" placeholder="没有合适标签可以先在此输入新增">
						</div>

						<div class="col-sm-1">
							<input type="button" class="btn  btn-addlabel" value="新增">
						</div>

					</div>

				<div class="div-addnewarticle row">
						<input type="button" class="btn  btn-addnewarticle" value="发 布 博 客">
						<input type="button" class="btn  btn-returnindex" value="返 回 首 页">
				</div>

				</div>


			</div>
		</div>
	</div>
	<div class="w_foot">
		<!--<div class="w_foot_copyright">© 2015~2016 版权所有 | <a target="_blank" href="http://www.miitbeian.gov.cn/" rel="nofollow">京ICP备15010892号-1</a></div>-->
		<div class="w_foot_copyright">Copyright © 2017-2020, www.cggeeker.cn. All Rights Reserved. </div>
	</div>
	<!--toTop-->
	<div id="shape">
		<div class="shapeColor">
			<div class="shapeFly">
			</div>
		</div>
	</div>


	<script type="text/javascript">

		$(function () {
			//通过get请求获取所有标签信息并填充下拉框
			$.get("/label/findAllLabel",function (result) {
				if(result.status == 200){
					var labelArr = result.data;
					$('#select-articlelabel').empty();
					for(let i in labelArr){
						$('#select-articlelabel').append('<option value="'+labelArr[i].labelName+'">'+labelArr[i].labelName+'</option>')
					}
				}else{}
			});

			//通过get请求获取所有管理员信息并填充下拉框
			$.get("/admin/findAllAdmin",function (result) {
				if(result.status == 200){
					var adminArr = result.data;
					$('#select-articlelabel').empty();
					for(let i in adminArr){
						$('#select-articleauthor').append('<option value="'+adminArr[i].adminName+'">'+adminArr[i].adminName+'</option>')
					}
				}else{}
			});



			/*
			* onpropertychange(jquery中是propertychange)： IE下，当一个HTML元素的属性改变的时候，都能通过 onpropertychange来即时捕获。
			*oninput(jquery中是input)：是onpropertychange的非IE浏览器版本，支持firefox和opera等浏览器，但有一点不同，
			* 						  它绑定于对象时，并非该对象所有属性改变都能触发事件，它只在对象value值发生改变时奏效。
			* */
			$(".input-articletitle").bind("input propertychange",function(event){ //jQuery实时监听input输入框值变化
				/*console.log($(".input-articletitle").val())*/
				var articleTitleLen = ($(".input-articletitle").val()).length;
				$(".max-length-change").text(articleTitleLen);
				if(articleTitleLen <= 50){  //博客文章标题不能超过50字
					$(".max-length-change").css({"color":"#32CD32"});
				}
				else if(articleTitleLen > 50){
					$(".max-length-change").css({"color":"#EE2C2C"});
				}

			});

			$(".input-articletitle").blur(function () {
				var inputValue = $(this).val();
				if(inputValue == "" || inputValue == undefined || inputValue == null){
					layer.msg("文章标题不能为空哟!",{time : 2*1000});
				}

			});

			$('.btn-addlabel').click(function () {
				var newLabelName = $('.input-addlabel').val()
				if(newLabelName == "" || newLabelName == undefined || newLabelName == null){
					layer.alert('新增标签名不能为空哟!', {
						icon: 7,
						title: "提示"
					});
				}else{
					$.ajax({
						type : "POST",
						url : "/label/insertNewLabel",
						data : {"newLabelName" : newLabelName},
						dataType : "json",
						success : function (result) {
							if(result.status == 200){
								//通过get请求获取所有标签信息并填充下拉框（刷新标签下拉框）
								$.get("/label/findAllLabel",function (result) {
									if(result.status == 200){
										var labelArr = result.data;
										$('#select-articlelabel').empty();
										for(let i in labelArr){
											$('#select-articlelabel').append('<option value="'+labelArr[i].labelName+'">'+labelArr[i].labelName+'</option>')
										}
									}else{}
								});
								layer.msg("标签已新增!",{time : 2*1000});
							}else{
								layer.alert('标签已存在,新增失败!', {
									icon: 5,
									title: "提示"
								});
							}
						},
						error : function () {
							layer.alert('标签已存在,新增失败!', {
								icon: 5,
								title: "提示"
							});
						}
					});
				}
			});



			//提交新的博客文章  //为解决jquery动态生成节点造成节点点击事件失效，这里我们采用js的事件委托机制处理
			$(document).on("click",".btn-addnewarticle",function(){

				var title = $('.input-articletitle').val();
				var content = $('.note-editable').html();   //这货不能用val()获取，当时傻逼了！
				var author = $('#select-articleauthor').val();
				var labelName = $('#select-articlelabel').val();
				if(content == ""||content == undefined || content == null){
					layer.msg("文章内容不能为空哟!",{time : 2*1000});
				}
				else if(title == "" || title == undefined || title == null){
					layer.msg("文章标题不能为空噢!",{time : 2*1000});
				}
				else{
					$.ajax({
						type : "POST",
						url : "/article/insertOneArticle",
						data : {
							"title":title,
							"content":content,
							"author":author
						},
						dataType : "json",
						success : function (result) {
							if(result.status == 200){
								layer.alert('文章发布成功啦!', {
									icon: 1,
									title: "温馨提示"
								});
								$.ajax({
									type : "POST",
									url : "/articleandlabel/insertOneArticleAndLabel",
									data : {
										"labelName":labelName,
										"title":title
									},
									dataType : "json",
									success : function (result) {
										if(result.status == 200){
											console.log("标签和新文章关联到位！");
										}else{
											console.log("标签和新文章关联失败！")
										}
									}

								});
							}else{
								layer.alert('文章发布出了点小问题!', {
									icon: 5,
									title: "温馨提示"
								});
							}
						}

					});
				}
				console.log("title:::::::::" + title);
				console.log("content:::::::::::::" + content);
				console.log("author:::::::::::" + author);

			});



			//点击返回按钮返回首页
			$('.btn-returnindex').click(function () {
				window.location.href = "/index.html";
			});






		});
	</script>

</body>
</html>
